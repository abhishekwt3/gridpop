{% schema %}
{
"name": "Exit Intent Popup",
"target": "section",
"settings": []
}
{% endschema %}
{% assign popup_settings = shop.metafields.exitPopup.settings %}
{% if popup_settings == blank %}
  <div class="popup-error">
    <p>Error: Popup settings not found.</p>
  </div>
{% else %}
  {% assign extracted_value = popup_settings | split: '"popupTemplate":"' | last | split: '"' | first %}
  {% assign popup_frequency = popup_settings | split: '"popupFrequency":"' | last | split: '"' | first %}
  {% assign popup_frequency_number = popup_frequency | times: 1 | default: 2 %}

  <div id="exit-popup-overlay" class="exit-popup-overlay">
    <div class="exit-popup-container">
      {% case extracted_value %}
        {% when "discount" %}
          {% render 'discount' ignore_missing: true %}
        {% when "newsletter" %}
          {% render 'newsletter' ignore_missing: true %}
        {% when "survey" %}
          {% render 'survey' ignore_missing: true %}
        {% else %}
          <div class="popup-template">
            <button type="pop-button" class="popup-close">&times;</button>
            <h2>Welcome!</h2>
            <p>Thank you for visiting our store.</p>
          </div>
      {% endcase %}
    </div>
  </div>
  <script>
    window.exitIntentConfig = {
      popupFrequency: {{ popup_frequency_number }}
    };
  </script>
{% endif %}
<script src="{{ 'exit-popup.js' | asset_url }}" defer></script>
<link rel="stylesheet" href="{{ 'exit-popup.css' | asset_url }}">
